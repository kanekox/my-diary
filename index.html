<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Diary</title>
  <link rel="stylesheet" href="style.css">
  
  <script type="module">
    // Firebase SDK èª­ã¿è¾¼ã¿
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, serverTimestamp, query, orderBy } 
      from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    // https://firebase.google.com/docs/web/setup#available-libraries

    // ã“ã“ã«è‡ªåˆ†ã® firebaseConfig ã‚’è²¼ã‚Šä»˜ã‘
    const firebaseConfig = {
      apiKey: "AIzaSyDJbyJTYOiVhUMLD2jJSUY7pXdpuAFsnm0",
      authDomain: "my-diary-app-wow.firebaseapp.com",
      projectId: "my-diary-app-wow",
      storageBucket: "my-diary-app-wow.firebasestorage.app",
      messagingSenderId: "75626019057",
      appId: "1:75626019057:web:2cbd06d1ca5616f4845150"
    };


    // åˆæœŸåŒ–
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // æ—¥è¨˜ä¿å­˜
    async function saveDiary() {
      const text = document.getElementById("diaryText").value;
      if (!text) return;
      await addDoc(collection(db, "diary"), {
        text: text,
        createdAt: serverTimestamp()
      });
      document.getElementById("diaryText").value = "";
      loadDiary();
    }

	// æ—¥è¨˜ä¸€è¦§å–å¾—
	async function loadDiary() {
	  const diaryList = document.getElementById("diaryList");
	  diaryList.innerHTML = "";
	  
	  const q = query(collection(db, "diary"), orderBy("createdAt", "desc"));
	  const querySnapshot = await getDocs(q);
	  
		querySnapshot.forEach((doc) => {
    		const data = doc.data();
	    	const createdAt = data.createdAt ? data.createdAt.toDate() : null;
    		const dateStr = createdAt
      			? createdAt.toLocaleString("ja-JP", { timeZone: "Asia/Tokyo" })
		    	: "æ—¥æ™‚ä¸æ˜";
		    const li = document.createElement("li");
		    li.textContent = `${dateStr}ï¼š${data.text}`;
	    	diaryList.appendChild(li);
	    });
	}
    

    window.saveDiary = saveDiary;
    window.onload = loadDiary;
  </script>
</head>
<body>
	<div class="container">
  		<h1>ğŸ““ My Diary</h1>
  		<textarea id="diaryText" rows="4" cols="40" placeholder="ä»Šæ—¥ã®å‡ºæ¥äº‹..."></textarea><br>
  		<button onclick="saveDiary()">ä¿å­˜</button>
  		<h2>æ—¥è¨˜ä¸€è¦§</h2>
  		<ul id="diaryList"></ul>
	</div>
</body>
</html>

